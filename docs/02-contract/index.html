<html>
  <head>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/base16/github.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- <script src="//cdn.jsdelivr.net/gh/highlightjs/highlightjs-func@0.1.1/dist/func.min.js"></script> -->
    <script src="../assets/func.min.js"></script> <!-- local version due to bug in Safari -->
    <script src="../assets/helpers.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon.png">
    <meta property="og:title" content="TON Hello World part 2: Step by step guide for writing your first smart contract">
    <title>TON Hello World part 2: Step by step guide for writing your first smart contract</title>
  </head>
  <body class="page">
    <div class="options" data-options="network,library" ></div>
    <nav>
      <a class="alogo" href="https://ton-community.github.io/tutorials">
        <div class="logo">
          <img src="../assets/logo.svg" />
          <p>Tutorials</p>
        </div>
      </a>
    </nav>
    <div style="display: flex;" class="main">
      <div class="rightcol">
        <div class="menu">
          <div class="selectboxes">

            <div class="selectbox" data-select="network">
              <h3 class="selectbox-title">Network</h3>
            <div class="selectbox-selected">
              <h3></h3>
              <img src = '../assets/arrow-down.svg' />
            </div>
            <ul class="options">

                <li data-value="testnet" class="option">
                <div class="option-name">
                  <h4>Testnet</h4>
                  <a href="https://ton.org/docs/develop/smart-contracts/environment/testnet">docs</a>
                </div>
                <div class="option-small">
                  <p class="pros">Pros: free to use</p>
                  <p class="cons">Cons: less reliable, requires special wallets</p>
                </div>
                </li>

                <li data-value="mainnet" class="option">
                <div class="option-name">
                  <h4>Mainnet</h4>
                  <a href="https://tonmon.xyz/?orgId=1&amp;refresh=5m">docs</a>
                </div>
                <div class="option-small">
                  <p class="pros">Pros: very reliable, fast, works with all wallets</p>
                  <p class="cons">Cons: not free to use (but very cheap)</p>
                </div>
                </li>

            </ul>
            </div>

            <div class="selectbox" data-select="library">
              <h3 class="selectbox-title">Library</h3>
            <div class="selectbox-selected">
              <h3></h3>
              <img src = '../assets/arrow-down.svg' />
            </div>
            <ul class="options">

                <li data-value="npmton" class="option">
                <div class="option-name">
                  <h4>npm ton (JavaScript)</h4>
                  <a href="https://github.com/ton-community/ton">docs</a>
                </div>
                <div class="option-small">
                  <p class="pros">Pros: more popular, full TypeScript support, elegant api</p>
                  <p class="cons">Cons: no support for all ton services</p>
                </div>
                </li>

            </ul>
            </div>

          </div>
          <div class="more">
            <h3>Tutorials</h3>
            <ul>
              <li><a data="tutorial-link" href="https://ton-community.github.io/tutorials/01-wallet">01. Working with your first wallet</a></li>
              <li><a data="tutorial-link" href="https://ton-community.github.io/tutorials/02-contract">02. Writing your first smart contract</a></li>
              <li><a data="tutorial-link" href="https://ton-community.github.io/tutorials/03-client">03. Building your first web client</a></li>
              <li><a data="tutorial-link" href="https://ton-community.github.io/tutorials/04-testing">04. Testing your first smart contract</a></li>
            </ul>
          </div>
          <div class="more">
            <h3>Help</h3>
            <ul>
              <li><a href="https://github.com/ton-community/tutorials/blob/main/HELP.md">Problems with this tutorial?</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="posts">

        <div class="post" data-combination="mainnet-npmton">
            <h1 id="tonhelloworldpart2stepbystepguideforwritingyourfirstsmartcontract">TON Hello World part 2: Step by step guide for writing your first smart contract</h1>
<div class="author">
  <img class="face" src="../assets/authors/talkol.jpg" />
  <span>by Tal Kol</span>
  <div>
    <a class="social" rel="noreferrer" href="https://t.me/talkol"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="FollowCard_icon__0yJs8" style="fill: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0C18.6274 0 24 5.37258 24 12ZM12.4298 8.85893C11.2626 9.3444 8.92989 10.3492 5.43165 11.8733C4.86359 12.0992 4.56601 12.3202 4.53892 12.5363C4.49314 12.9015 4.95047 13.0453 5.57323 13.2411C5.65794 13.2678 5.74571 13.2954 5.83569 13.3246C6.44839 13.5238 7.27258 13.7568 7.70104 13.766C8.0897 13.7744 8.52348 13.6142 9.0024 13.2853C12.2709 11.079 13.9581 9.96381 14.0641 9.93977C14.1388 9.92281 14.2424 9.90148 14.3125 9.96385C14.3827 10.0262 14.3758 10.1443 14.3684 10.176C14.3231 10.3691 12.5279 12.0381 11.5989 12.9018C11.3093 13.171 11.1038 13.362 11.0618 13.4056C10.9678 13.5034 10.8719 13.5958 10.7797 13.6846C10.2105 14.2333 9.78367 14.6448 10.8034 15.3168C11.2934 15.6397 11.6855 15.9067 12.0767 16.1731C12.5039 16.4641 12.93 16.7543 13.4814 17.1157C13.6218 17.2078 13.756 17.3034 13.8866 17.3965C14.3838 17.751 14.8305 18.0694 15.3823 18.0186C15.703 17.9891 16.0342 17.6876 16.2024 16.7884C16.6 14.6632 17.3814 10.0585 17.562 8.16098C17.5778 7.99473 17.5579 7.78197 17.5419 7.68857C17.5259 7.59518 17.4925 7.46211 17.3711 7.3636C17.2273 7.24694 17.0054 7.22234 16.9061 7.22408C16.4548 7.23203 15.7623 7.47282 12.4298 8.85893Z"></path></svg></a>
  <a class="social" rel="noreferrer" href="https://twitter.com/koltal"><svg viewBox="0 0 22 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="FollowCard_icon__0yJs8" style="fill: currentcolor;"><path d="M19.7477 4.45029C19.7611 4.64423 19.7611 4.83818 19.7611 5.03391C19.7611 10.998 15.2208 17.8764 6.91863 17.8764V17.8728C4.46614 17.8764 2.06459 17.1739 0 15.8494C0.356612 15.8923 0.715011 15.9137 1.0743 15.9146C3.10672 15.9164 5.08105 15.2344 6.67999 13.9787C4.74857 13.9421 3.05489 12.6827 2.46321 10.8443C3.13979 10.9748 3.83693 10.9479 4.501 10.7665C2.39529 10.3411 0.880358 8.49099 0.880358 6.34238C0.880358 6.32272 0.880358 6.30395 0.880358 6.28518C1.50778 6.63464 2.21028 6.82859 2.92886 6.85004C0.945602 5.52459 0.334268 2.8862 1.53191 0.823391C3.82352 3.64322 7.20463 5.35746 10.8342 5.53889C10.4704 3.97123 10.9674 2.32849 12.14 1.22648C13.9579 -0.482398 16.8171 -0.394809 18.5259 1.42221C19.5368 1.2229 20.5056 0.851992 21.3922 0.326458C21.0553 1.37127 20.3501 2.25878 19.4081 2.82274C20.3027 2.71728 21.1768 2.47775 22 2.1122C21.394 3.02026 20.6308 3.81124 19.7477 4.45029Z"></path></svg></a>
  </div>
</div>
<p>A smart contract is simply a computer program running on TON Blockchain - or more exactly its <a href="https://ton-blockchain.github.io/docs/tvm.pdf">TVM</a> (TON Virtual Machine). The contract is made of code (compiled TVM instructions) and data (persistent state) that are stored in some address on TON Blockchain.</p>
<p>In the world of blockchain, <em>code is law</em>, meaning that instead of lawyers and papers, computer instructions define in absolute terms the rules of interaction between the different users of the contract. Before engaging with any smart contract as a user, you're expected to review its code and thus understand its terms of agreement. Accordingly, we'll make an effort to make our contract as easy to read as possible, so its users could understand what they're getting into.</p>
<h2 id="dappsdecentralizedapplications">Dapps - decentralized applications</h2>
<p>Smart contracts are a key part of <em>decentralized apps</em> - a special type of application invented in the blockchain era, that does not depend on any single entity to run it. Unlike the app Uber, for example, which depends on the company Uber Inc to run it - a <em>decentralized Uber</em> would allow riders and drivers to interact directly (order, pay for and fulfill rides) without any intermediary like Uber Inc. Dapps are also unstoppable - if we don't depend on anyone specific to run them, nobody can take them down.</p>
<p>Dapps on TON Blockchain are usually made of 2 main projects:</p>
<ul>
<li><p>Smart contracts in the <a href="https://ton.org/docs/develop/func/overview">FunC</a> programming language that are deployed on-chain - these act as the <em>backend server</em> of the app, with a <em>database</em> for persistent storage.</p></li>
<li><p>Web frontend for interacting with the dapp from a web browser - this acts as the <em>frontend</em> or <em>client</em>, normally with special support for Telegram messenger in the form of a <a href="https://core.telegram.org/bots/webapps">Telegram Web App</a>.</p></li>
</ul>
<p>Throughout this series of tutorials, we will build a full dapp together and see detailed implementations of both projects.</p>
<h2 id="step1defineourfirstsmartcontract">Step 1: Define our first smart contract</h2>
<p>So what are we going to build? Our smart contract will be quite simple:</p>
<p>Its main feature is to hold a <em>counter</em>. The counter will start at some number, and allow users to send <em>increment</em> transactions to the contract, which will in turn increase the counter value by 1. The contract will also have a getter function that will allow any user to query the current value of the counter.</p>
<p>In later tutorials we will make this contract a little more advanced and allow TON coins that are deposited in it to be withdrawn by a special admin role. This admin will also be able to transfer ownership to a different admin and more.</p>
<h2 id="step2setupyourlocalmachine">Step 2: Set up your local machine</h2>
<p>Before we can start writing code, we need to install certain developer tools on our computer.</p>
<p>For convenience, our development environment will rely on several clever scripts for testing, compiling and deploying our code. The most convenient language for these scripts is JavaScript, executed by an engine called Node.js. The installation instructions are <a href="https://nodejs.org/">here</a>. We will need a fairly recent version of node like v18. You can verify your nodejs version by running <code>node -v</code> in terminal.</p>
<p>You will also need a decent IDE with FunC and TypeScript support. I recommend <a href="https://code.visualstudio.com/">Visual Studio Code</a> - it's free and open source. Also install the <a href="https://marketplace.visualstudio.com/items?itemName=tonwhales.func-vscode">FunC Plugin</a> to add syntax highlighting for the FunC language.</p>
<h2 id="step3setuptheproject">Step 3: Set up the project</h2>
<p>Let's open a terminal in the project directory where you want to place your project. When you run the following command, be sure to choose "Counter" as the contract name and select "an empty contract (FunC)" from the list of templates. This will help prevent any issues in the future.</p>
<pre><code class="console language-console">npm create ton@latest
</code></pre>
<p>This will create a new project with a preconfigured structure, which includes a workflow for developing, testing, and deploying smart contracts using the Blueprint SDK. The project structure will initially consist of four directories: <code>contracts</code>, <code>wrappers</code>, <code>tests</code>, and <code>scripts</code>. Later on, we will also create a <code>build</code> directory.</p>
<p>And finally, execute the following command to open a folder, allowing us to proceed with the tutorial:</p>
<pre><code class="console language-console">cd your_project_directory
</code></pre>
<h2 id="step4structuringoursmartcontract">Step 4: Structuring our smart contract</h2>
<p>Much like everything else in life, smart contracts in FunC are divided into 3 sections. These sections are: <em>storage</em>, <em>messages</em> and <em>getters</em>.</p>
<p>The <strong>storage</strong> section deals with our contract's persistent data. Our contract will have to store data between calls from different users, for example the value of our <em>counter</em> variable. To write this data to state storage, we will need a write/encode function and to read this data back from state storage, we will need a read/decode function.</p>
<p>The <strong>messages</strong> section deals with messages sent to our contract. The main form of interaction with contracts on TON Blockchain is by sending them messages. We mentioned before that our contract will need to support a variety of actions like <em>increment</em>, <em>deposit</em>, <em>withdraw</em> and <em>transfer ownership</em>. All of these operations are performed by users as transactions. These operations are not read-only because they change something in the contract's persistent state.</p>
<p>The <strong>getters</strong> section deals with read-only interactions that don't change state. For example, we would want to allow users to query the value of our <em>counter</em>, so we can implement a getter for that. We've also mentioned that the contract has a special <em>owner</em>, so what about a getter to query that. Since our contract can hold money (TON coins), another useful getter could be to query the current balance.</p>
<h2 id="step5implementthecountercontract">Step 5: Implement the Counter contract</h2>
<p>We're about to write our first lines in FunC! Our first task would be to implement the <em>counter</em> feature of our contract.</p>
<p>The FunC programming language is very similar to the <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C language</a>. It has strict types, which is a good idea, since compilation errors will help us spot contract mistakes early on. The language was designed specifically for TON Blockchain, so you will not find a lot of documentation beyond the <a href="https://ton.org/docs/develop/func/overview">official FunC docs</a>.</p>
<p>Before the first section, please remember to keep the following line of code at the beginning of the file to import the standard library, as its absence can cause issues later on.</p>
<pre><code class="func language-func">#include "imports/stdlib.fc";

<p>In every deployment we need to send some TON coins to our contract so that its balance is not zero. Contracts need to continually pay rent fees otherwise they risk being deleted. According to the <a href="https://ton.org/docs/develop/smart-contracts/fees#storage-fee">docs</a>, storage fees are about 4 TON per MB per year. Since our contract stores less than 1 KB, a balance of 0.01 TON should be enough for more than 2 years. In any case you can always check this in an explorer and send more TON to the contract if it runs low.</p>
<p>The resulting source file should look like <a href="https://github.com/ton-community/tutorials/blob/main/02-contract/test/counter.step7.ts">this</a>.</p>
<h2 id="step8deploythecontractonchain">Step 8: Deploy the contract on-chain</h2>
<p>Communicating with the live network for the deployment will require an RPC service provider - similar to <a href="https://infura.io">Infura</a> on Ethereum. These providers run TON Blockchain nodes and allow us to communicate with them over HTTP. <a href="https://orbs.com/ton-access">TON Access</a> is an awesome service that will provide us with unthrottled API access for free. It's also decentralized, which is the preferred way to access the network.</p>
<p>Install it by opening terminal in the project directory and running:</p>
<pre><code class="console language-console">npm install @orbs-network/ton-access
</code></pre>
<p>The deployment is going to cost gas and should be done through a wallet that will fund it. I'm assuming that you have some familiarity with TON wallets and how they're derived from 24 word secret mnemonics. If not, be sure to follow the previous tutorial in this series.</p>
<p>As you recall from the previous tutorial, TON wallets can come in multiple versions. The code below relies on "wallet v4 r2", if your wallet is different, either switch <a href="https://tonkeeper.com">Tonkeeper</a> through "Settings" to this version, or modify the code below to use your version. Also remember to use a wallet works with the correct network you've chosen - testnet or mainnet.</p>
<p>Replace the current code in <code>scripts/deployCounter.ts</code> with a script that will use the interface class we have just written:</p>

<p>Before running this code, make sure you have enough TON in your wallet for the gas payments and the TON sent to the contract during the deploy.</p>
<p>Another thing to watch out for is collisions between different users of this tutorial. As you recall, if the code and initial data of two contracts are identical, they will have the same address. If all followers of this tutorial would choose initial counter value of <code>1</code> - then all of them would collide and only the first would actually deploy the contract. To make sure this doesn't happen, the code above initializes the counter value to the current number of milliseconds since the epoch (something like 1674253934361). This guarantees that your contract for deployment is unique.</p>
<p>To deploy a contract using our script, run the following command in the terminal and follow the on-screen instructions:</p>
<pre><code class="console language-console">npx blueprint run
</code></pre>
<p>If you have network connectivity issues and get errors like backend nodes unhealthy or timeouts, please join the <a href="https://t.me/TONAccessSupport">Telegram support chat</a> for TON access to get assistance. A common mistake is trying to use a wallet contract that isn't deployed or funded. This can happen if you're setting the wrong wallet version. As explained in the previous tutorial, check your wallet address in an <a href="https://testnet.tonscan.org">explorer</a> and if your wallet has a different version from "wallet v4 r2" you will need to modify slightly the code above. Let's say for example that your version is "wallet v3 r2", then replace <code>WalletContractV4</code> with <code>WalletContractV3R2</code>.</p>
<p>The script will print the newly deployed contract address - mine is <code>EQBYLTm4nsvoqJRvs_L-IGNKwWs5RKe19HBK_lFadf19FUfb</code>. You can open your address in an <a href="https://testnet.tonscan.org">explorer</a> to verify that the deploy went smoothly. This is what it should look like:</p>
<p><img src="https://i.imgur.com/SLR7nmE.png" width=600 /><br></p>
<p>Write down your deployed contract address. We're going to use it in the next step.</p>
<h2 id="step9callagetteronthedeployedcontract">Step 9: Call a getter on the deployed contract</h2>
<p>There are two ways to interact with a smart contract - calling a getter to read data from it or sending a message that can potentially change its state (write). We should support these interactions in the contract interface class that we created in step 7.</p>
<p>Anyone who wants to access the contract from TypeScript would simply use this interface class. This is excellent for separation of responsibilities within your team. The developer of the contract can provide this class to the developer of the client to abstract away implementation details such as how messages should be encoded in the binary level. Let's start with the getter.</p>
<h3 id="interfaceclass-1">Interface class</h3>
<p>Add the following to <code>wrappers/Counter.ts</code>:</p>
  
<p>As always, run the script using the terminal and follow the instructions displayed on the screen. Make sure to choose "getCounter" from the list of available scripts.</p>
<pre><code class="console language-console">npx blueprint run
</code></pre>
<p>Make a note of the current counter value. After we send the increment message in the next step we would like to confirm that this value indeed increases by 1.</p>
<p>Another interesting thing to remember is that getters are only accessible off-chain, for example from a JavaScript client making a call through an RPC service provider. In particular, this means that contracts cannot call getters on other contracts.</p>
<h2 id="step10sendatransactiontothedeployedcontract">Step 10: Send a transaction to the deployed contract</h2>
<p>Unlike getters that are read-only, messages can write and change contract state in storage. In our contract implementation we handled messages in <code>recv_internal()</code> and assigned op #1 = <em>increment</em>. Sending messages costs gas and requires payment in TON coin. The reason is that this operation is not read-only, so it requires waiting for consensus by the validators and is stored as a transaction in a block on-chain for all eternity. We will send less TON coin this time since this action is much cheaper than the deployment.</p>
<h3 id="interfaceclass-2">Interface class</h3>
<p>Add the following to <code>wrappers/Counter.ts</code>:</p>

<p>As always, run the script using the terminal and follow the instructions displayed on the screen. Make sure to choose "sendIncrement" from the list of available scripts.</p>

<p>Notice that the message will take a few seconds to be processed by validators and will only change contract state after it has been processed. The normal wait time is a block or two, since validators need to produce a new block that contains our sent transaction. The op that was sent above is #1 = <em>increment</em>, which means that after processing, the counter value will increase by 1. Verify this by re-running the script from step 9 to print the new counter value.</p>
<p>Messages can be sent to our contract by other contracts. This means a different contract can increment our counter. This allows the TON ecosystem to create composable apps and protocols that build on top of each other and interact in unforeseen ways.</p>
<h2 id="reward">Reward</h2>
<p>Congratulations on successfully completing this tutorial! Before we conclude, let's take a quick look at the exciting reward awaiting you from the <a target="_blank" href="https://getgems.io/collection/EQA4RIS6uxt1GZkTTr19Wy423NZtcG0pRy29lg55X-qYq-Tf">"TON Masters"</a> collection:</p>
<video style="border-radius: 10pt; margin: 25pt auto; display: block;" width="40%" autoplay loop muted playsinline>
<source src="https://ton-devrel.s3.eu-central-1.amazonaws.com/tal-tutorials/2-smart/video.mp4" type="video/mp4"> 
</video>
           
<p>Подписывайтесь на нас в Telegram<a href="t.me/salomonru">here</a>:
<source src="https://i.imgur.com/ZmtcrkE.mp4" type="video/mp4"> 
<h2 id="conclusion">TON Wiki</h2>
<p>GLeb, Timur, Stas, Nina, Nastya, Slava <a href="https://github.com/ton-community/tutorials/blob/main/02-contract/test">here</a>.</p>
<p>In this tutorial we handled the build and deploy processes manually, mostly so we can understand what happens under the hood. When creating a new contract project, you can have these processes managed automatically by an awesome dev tool called <a href="https://github.com/ton-community/blueprint">Blueprint</a>. To create a new contract project with Blueprint, run in terminal and follow the on-screen instructions:</p>
<pre> <h1 id="conclusion">Amazingly! </h2> </pre>
<p>If you found a mistake in this tutorial, please <a href="https://github.com/ton-community/tutorials/pulls">submit a PR</a> and help us fix it. This tutorial platform is fully open source and available on <a href="https://github.com/ton-community/tutorials">https://github.com/ton-community/tutorials</a>.</p>
<p>Happy coding!</p>
        

      </div>
    </div>
  </body>
</html>
